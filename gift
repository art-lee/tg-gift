## –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –≥–∞–π–¥: —Å–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ Telegram —á–µ—Ä–µ–∑ Telethon (—Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ)

### 1. –°–æ–∑–¥–∞–π –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –Ω–µ—ë

```bash
mkdir gift-bot
cd gift-bot
```

---

### 2. –°–æ–∑–¥–∞–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

apt update
apt install python3-venv
python3 -m venv venv
source venv/bin/activate

- –ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—è–≤–∏—Ç—Å—è `(venv)`.  
- –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.

---

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install telethon python-dotenv
```
- [Telethon ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è][1]
- [Skillbox: –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å Telethon][5]

---

### 4. –ü–æ–ª—É—á–∏ API ID –∏ API Hash

1. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ [my.telegram.org](https://my.telegram.org).
2. –í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç Telegram.
3. –ü–µ—Ä–µ–π–¥–∏ –≤ —Ä–∞–∑–¥–µ–ª **API development tools**.
4. –°–æ–∑–¥–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏ URL –ª—é–±—ã–µ, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ Desktop).
5. –°–æ—Ö—Ä–∞–Ω–∏ **API ID** –∏ **API Hash**.

---

### 5. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` —Å –¥–∞–Ω–Ω—ã–º–∏

```env
API_ID=—Ç–≤–æ–π_api_id
API_HASH=—Ç–≤–æ–π_api_hash
SESSION_NAME=gift_session
DEFAULT_GIFT_COUNT=121
POLL_INTERVAL=10
BOT_TOKEN=
CHAT_ID=
- `SESSION_NAME` ‚Äî –ª—é–±–æ–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, gift_session.

---

### 6. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `bot.py` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
import os
import json
import time
import asyncio
from dotenv import load_dotenv, dotenv_values
from telethon import TelegramClient, functions

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()
API_ID = int(os.getenv('API_ID'))
API_HASH = os.getenv('API_HASH')
SESSION_NAME = os.getenv('SESSION_NAME', 'gift_session')
POLL_INTERVAL = int(os.getenv('POLL_INTERVAL', 10))
BOT_TOKEN = os.getenv('BOT_TOKEN')
CHAT_ID = int(os.getenv('CHAT_ID'))
GIFTS_FILE = 'gifts.json'

def get_default_gift_count():
    env = dotenv_values('.env')
    return int(env.get('DEFAULT_GIFT_COUNT', 121))

async def send_alert(message):
    try:
        print(f"==> send_alert: –ø—Ä–æ–±—É—é –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —á–∞—Ç {CHAT_ID} —á–µ—Ä–µ–∑ –±–æ—Ç–∞")
        async with TelegramClient('bot_alert', API_ID, API_HASH) as bot_client:
            await bot_client.start(bot_token=BOT_TOKEN)
            await bot_client.send_message(entity=CHAT_ID, message=message)
        print("==> send_alert: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: {str(e)}")

async def check_gifts(client):
    result = await client(functions.payments.GetStarGiftsRequest(hash=0))
    return [gift.id for gift in result.gifts], len(result.gifts)

async def monitor_gifts():
    async with TelegramClient(SESSION_NAME, API_ID, API_HASH) as client:
        while True:
            try:
                gift_ids, count = await check_gifts(client)
                with open(GIFTS_FILE, 'w', encoding='utf-8') as f:
                    json.dump({
                        "gift_ids": gift_ids,
                        "gift_count": count,
                        "last_update": int(time.time())
                    }, f, indent=2)
                print(f"–¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {count}")

                DEFAULT_GIFT_COUNT = get_default_gift_count()
                print(f"–¢–µ–∫—É—â–∏–π –ø–æ—Ä–æ–≥ –∏–∑ .env: {DEFAULT_GIFT_COUNT}")
                if count > DEFAULT_GIFT_COUNT:
                    print(f"!!! –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: {count} > {DEFAULT_GIFT_COUNT}")
                    await send_alert(f"üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ {count} –ø–æ–¥–∞—Ä–∫–æ–≤ (–ø–æ—Ä–æ–≥: {DEFAULT_GIFT_COUNT})")
                else:
                    print(f"–£—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: {count} <= {DEFAULT_GIFT_COUNT}")

                await asyncio.sleep(POLL_INTERVAL)
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: {str(e)}")
                await asyncio.sleep(30)

if __name__ == '__main__':
    asyncio.run(monitor_gifts())



**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–¥—É:**
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ (–∫–ª—é—á–∏, –∏–º—è —Å–µ—Å—Å–∏–∏) –±–µ—Ä—É—Ç—Å—è –∏–∑ `.env` ‚Äî —É–¥–æ–±–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∫–æ–¥ –∏–∑ Telegram.
- –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ (`gift_session.session`), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –Ω–∞–¥–æ —É–¥–∞–ª—è—Ç—å.
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, –ø–æ–∫–∞ —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ –Ω–µ —É–¥–∞–ª—ë–Ω.

---

### 7. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
python bot.py
```
- –í–≤–µ–¥–∏ —Ç–æ–∫–µ–Ω
- –í–≤–µ–¥–∏ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–¥—ë—Ç –≤ Telegram.
- –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–∫–∞ ‚Äî –≤–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å.

---
### 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

- –í –ø–∞–ø–∫–µ –ø–æ—è–≤–∏—Ç—Å—è —Ñ–∞–π–ª `gifts.json` —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
- –í –ø–∞–ø–∫–µ –±—É–¥–µ—Ç —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ (`gift_session.session`)

---



–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥, –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞ —á–µ—Ä–µ–∑ systemd, —á—Ç–æ–±—ã –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö. –í—Å—ë –¥–µ–ª–∞–µ—Ç—Å—è **–±–µ–∑ screen** –∏ –¥—Ä—É–≥–∏—Ö —Ä—É—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ Linux.

---

## 1. –ü—Ä–æ–≤–µ—Ä—å, –≥–¥–µ –ª–µ–∂–∏—Ç —Ç–≤–æ–π –±–æ—Ç

- –ü—É—Å—Ç—å –±–æ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `/root/gift-bot/bot.py`
- –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å) ‚Äî `/root/gift-bot/venv`

---

## 2. –°–æ–∑–¥–∞–π systemd unit-—Ñ–∞–π–ª –¥–ª—è –±–æ—Ç–∞

–û—Ç–∫—Ä–æ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, nano):

```bash
sudo nano /etc/systemd/system/giftbot.service
```

–í—Å—Ç–∞–≤—å —Ç–∞–∫–æ–π —à–∞–±–ª–æ–Ω (–∑–∞–º–µ–Ω–∏ –ø—É—Ç–∏ –Ω–∞ —Å–≤–æ–∏!):

```ini
[Unit]
Description=Telegram Gift Bot
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/root/gift-bot
ExecStart=/root/gift-bot/venv/bin/python bot.py
Restart=always
RestartSec=10
StandardOutput=append:/var/log/giftbot.log
StandardError=append:/var/log/giftbot.log

[Install]
WantedBy=multi-user.target
```
- **User=root** ‚Äî –µ—Å–ª–∏ –±–æ—Ç –ª–µ–∂–∏—Ç –≤ /root, –∏–Ω–∞—á–µ —É–∫–∞–∂–∏ —Å–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- **WorkingDirectory** ‚Äî –ø–∞–ø–∫–∞, –≥–¥–µ –ª–µ–∂–∏—Ç –±–æ—Ç –∏ venv.
- **ExecStart** ‚Äî –ø—É—Ç—å –¥–æ python –∏–∑ venv –∏ —Å–∫—Ä–∏–ø—Ç–∞.
- **Restart=always** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –ø–æ—Å–ª–µ —Å–±–æ—è –∏–ª–∏ –æ—à–∏–±–∫–∏[3][4][5][6][1].
- **StandardOutput/StandardError** ‚Äî –ª–æ–≥–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ `/var/log/giftbot.log`.

---

## 3. –ê–∫—Ç–∏–≤–∏—Ä—É–π –∏ –∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å

```bash
sudo systemctl daemon-reload
sudo systemctl enable giftbot
sudo systemctl start giftbot
```

---

## 4. –ü—Ä–æ–≤–µ—Ä—è–π —Å—Ç–∞—Ç—É—Å –∏ –ª–æ–≥–∏

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
  ```bash
  systemctl status giftbot
  ```
  –î–æ–ª–∂–Ω–æ –±—ã—Ç—å `active (running)`.

- –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
  ```bash
  tail -f /var/log/giftbot.log
  ```
  –∏–ª–∏
  ```bash
  journalctl -u giftbot -n 50
  ```

---

## 5. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è unit-—Ñ–∞–π–ª–∞:
  ```bash
  sudo systemctl daemon-reload
  sudo systemctl restart giftbot
  ```

---
  –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å:
  systemctl status giftbot


---

## 7. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥-—Ñ–∞–π–ª `/var/log/giftbot.log` ‚Äî —Ç–∞–º –±—É–¥—É—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞.
- –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã.
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ python –∏ bot.py —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
- –ï—Å–ª–∏ –º–µ–Ω—è–µ—à—å —á—Ç–æ-—Ç–æ –≤ unit-—Ñ–∞–π–ª–µ ‚Äî –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π `systemctl daemon-reload`.

---

## 8. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

- `Restart=always` ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Å–µ–≥–¥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±–æ—Ç–æ–≤).
- `Restart=on-failure` ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—à–∏–±–∫–µ.
- `RestartSec=5` ‚Äî –∂–¥–∞—Ç—å 5 —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º[4].
